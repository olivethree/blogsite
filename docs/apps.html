<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.0.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Manuel Oliveira - Tools</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./assets/robots.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-176122484-2', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="Manuel Oliveira - Tools">
<meta property="og:description" content="Run the Brief Reverse Correlation Task locally in your browser (no internet required).">
<meta property="og:site-name" content="Manuel Oliveira">
<meta name="twitter:title" content="Manuel Oliveira - Tools">
<meta name="twitter:description" content="Run the Brief Reverse Correlation Task locally in your browser (no internet required).">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Manuel Oliveira</span>
  </a>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./blog.html">Blog</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./publications.html">Publications</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./apps.html" aria-current="page">Tools</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html">About</a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/olivethree"><i class="bi bi-github" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/manueljbo"><i class="bi bi-twitter-x" role="img">
</i> 
 </a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/manueljbo/"><i class="bi bi-linkedin" role="img">
</i> 
 </a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#brief-reverse-correlation-task" id="toc-brief-reverse-correlation-task" class="nav-link active" data-scroll-target="#brief-reverse-correlation-task"><span>Brief Reverse Correlation Task</span></a>
  <ul class="collapse">
  <li><a href="#r-script-to-generate-stimuli" id="toc-r-script-to-generate-stimuli" class="nav-link" data-scroll-target="#r-script-to-generate-stimuli">R script to generate stimuli</a></li>
  <li><a href="#setting-up-the-experiment" id="toc-setting-up-the-experiment" class="nav-link" data-scroll-target="#setting-up-the-experiment">Setting up the experiment</a></li>
  <li><a href="#generating-individual-classification-images-from-brief-rc-task-data" id="toc-generating-individual-classification-images-from-brief-rc-task-data" class="nav-link" data-scroll-target="#generating-individual-classification-images-from-brief-rc-task-data">Generating Individual Classification Images from Brief RC task data</a></li>
  <li><a href="#modified-function-to-generate-briefrc-cis" id="toc-modified-function-to-generate-briefrc-cis" class="nav-link" data-scroll-target="#modified-function-to-generate-briefrc-cis">Modified function to generate BriefRC CIs</a></li>
  <li><a href="#script-to-generate-individual-ci" id="toc-script-to-generate-individual-ci" class="nav-link" data-scroll-target="#script-to-generate-individual-ci">Script to generate Individual CI</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  <li><a href="#reverse-correlation-sampling-subgroup-cis" id="toc-reverse-correlation-sampling-subgroup-cis" class="nav-link" data-scroll-target="#reverse-correlation-sampling-subgroup-cis"><span>Reverse Correlation: Sampling Subgroup CIs</span></a></li>
  <li><a href="#face-masker" id="toc-face-masker" class="nav-link" data-scroll-target="#face-masker"><span>Face Masker</span></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Tools</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="brief-reverse-correlation-task" class="level1">
<h1><a href="https://github.com/olivethree/briefRC">Brief Reverse Correlation Task</a></h1>
<p>Run the Brief Reverse Correlation Task locally in your browser (no internet required).</p>
<p>Demo version of full web task here: <a href="https://olivethree.github.io/briefrc12online/" class="uri">https://olivethree.github.io/briefrc12online/</a></p>
<p>In this demo you can see how the full task works and obtain actual results you can use for learning. Using the target category “Star Wars Fan” for the sake of demonstartion. Prefer Star Trek? Let me know and I’ll make that version! :)</p>
<p><br>
## Generating stimuli for the task</p>
<p>Select a base face image. In this example, I use the average of the average male and average female faces, facing forward and with neutral expression, from the Karolinska Face Database (Lundqvist, Flykt, &amp; Öhman, 1998).</p>
<p>Next you, you need to decide how many trials you need for your task. In a traditional 2-image forced-choice Reverse Correlation task, we need a pair of images per trial. Therefore, the total images you need to generate as stimuli for the task = [number of trials you want] x [number of images per trial]. For the case of 2 images per trial, this would be 600 images for 300 trials.</p>
<p>However, the benefit of using Brief RC is so you can present more images per trial. In this tutorial I focus on the version with 12 images per trial. Twelve images per trial is, in my opinion, a reasonable amount to present in most devices’ screens, while keeping a manageable informational load for the participants.</p>
<p>In the Brief RC 12 version, 12 images are presented in each trial. These are not random images from the pool of stimuli. Instead, these are actually 6 pairs of images, where each pair is associated with a specific number (assigned during the noise generation procedure) and includes an original noise patch (labelled as <em>ori</em>) and its inverted noise (labelled as <em>inv</em>).</p>
<p>In this case, I will follow the trials used by the Brief RC’s authors (Schmitz et al., 2024) for the Brief RC 12 task:</p>
<p><strong>Total trials:</strong> 60</p>
<p><strong>Images per trial:</strong> 12 (6 pairs of ori-inv images)</p>
<p><strong>Total images to generate</strong> = 720</p>
<p>Finally, the generated images are resized for proper fit within the screen area. Image stimuli in the RC task (used in psychology research) are frequently 512x512 px, or 256x256, or 128x128. Here, we will use 128x128 as the final output size for the stimulus images. Importantly, your base face image will need to be resized to these dimensions as well, and make sure this does not stretch or alter the original base face image in any way (unless you have any reasons to distort the natural configuration of a face).</p>
<section id="r-script-to-generate-stimuli" class="level3">
<h3 class="anchored" data-anchor-id="r-script-to-generate-stimuli">R script to generate stimuli</h3>
<p>Note: R scripts are adapted from the original materials shared by Schmitz et al.&nbsp;(2024).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magick)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Github packages</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(devtools)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># rcicr</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(rcicr)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'rdotsch/rcicr'</span>); <span class="fu">library</span>(rcicr)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>{<span class="co"># Seed for reproducibility}</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>gen_seed   <span class="ot">&lt;-</span> <span class="dv">1984</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define how many task trials you want</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>nr_task_trials <span class="ot">&lt;-</span> <span class="dv">60</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Number of image pairs (ori + inv)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>nr_rc_trials <span class="ot">&lt;-</span> nr_task_trials <span class="sc">*</span> <span class="dv">6</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Setting script to generate stimuli for a total of: "</span>, nr_task_trials, <span class="st">"trials (Brief RC 12 version).</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"This means you will have a total of "</span>, nr_rc_trials, <span class="st">"image pairs, or "</span>, nr_rc_trials<span class="sc">*</span><span class="dv">2</span>, <span class="st">"total amount of images."</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Path for base face image file (average of the average male and average female face of the Karolinska face database, neutral expression, frontal pose)</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>path_baseface <span class="ot">&lt;-</span> <span class="st">"FMNES.jpg"</span> <span class="co"># Replace with your own base image</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Output directory to store the stimuli images</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>output_path  <span class="ot">&lt;-</span> <span class="st">"img/"</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Stimuli generation</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>noise_matrix <span class="ot">&lt;-</span> rcicr<span class="sc">::</span><span class="fu">generateStimuli2IFC</span>(</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">base_face_files     =</span> <span class="fu">list</span>(<span class="st">'avg'</span> <span class="ot">=</span> path_baseface),</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">n_trials            =</span> nr_rc_trials,</span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed                =</span> gen_seed,</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_as_png         =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">stimulus_path       =</span> output_path,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">return_as_dataframe =</span> <span class="cn">TRUE</span>,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">save_rdata          =</span> <span class="cn">FALSE</span></span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Noise matrix</span></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert noise matrix to a data.table object</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>noise_matrix <span class="ot">&lt;-</span> <span class="fu">data.table</span>(noise_matrix)</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a><span class="co"># save it as txt file</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a><span class="fu">fwrite</span>(noise_matrix, <span class="at">file =</span> <span class="st">"noise_matrix.txt"</span>, <span class="at">sep =</span> <span class="st">" "</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename image files</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a><span class="co"># Ori files</span></span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="at">path =</span> output_path, <span class="at">pattern =</span> <span class="st">"ori.png"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste0</span>(output_path, <span class="st">"faceOri"</span>, <span class="fu">seq_along</span>(.), <span class="st">".png"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(., <span class="fu">names</span>(.), file.rename)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Inv files</span></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="at">path =</span> output_path, <span class="at">pattern =</span> <span class="st">"inv.png"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">paste0</span>(output_path, <span class="st">"faceInv"</span>, <span class="fu">seq_along</span>(.), <span class="st">".png"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk2</span>(., <span class="fu">names</span>(.), file.rename)</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Resize image files for brief RC task</span></span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a><span class="co"># Define image size (original brief RC paper used 150 x 150 px)</span></span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>new_size <span class="ot">&lt;-</span> <span class="st">"150"</span></span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the 'resized' directory if it doesn't exist</span></span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="fu">file.path</span>(output_path, <span class="st">"resized"</span>), <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Process and move images to 'resized' </span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(output_path, <span class="at">pattern =</span> <span class="st">"face"</span>, <span class="at">full.names =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">walk</span>(<span class="cf">function</span>(img_path) {</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    outpath <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">".png"</span>, <span class="st">"s.png"</span>, img_path)</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    resized_path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_path, <span class="st">"resized"</span>, <span class="fu">basename</span>(outpath))</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="fu">image_read</span>(img_path) <span class="sc">%&gt;%</span></span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>      <span class="fu">image_scale</span>(new_size) <span class="sc">%&gt;%</span></span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>      <span class="fu">image_write</span>(<span class="at">path =</span> resized_path, <span class="at">format =</span> <span class="st">"png"</span>)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once the generation is completed, you can find the image stimulus set in “img/resized”. All you need to do next is to copy paste these images to the appropriate experiment folder containing the images (see below).</p>
<p>Importantly, this script generates the noise matrix file (very large file), that contains the information you need to compute the classification images after you run the experiment.</p>
</section>
<section id="setting-up-the-experiment" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-the-experiment">Setting up the experiment</h2>
<p>These instructions outline how to set up and run the Brief Reverse Correlation task developed by Schmitz et al.&nbsp;(2024) on your local machine.</p>
<section id="create-a-project-folder" class="level4">
<h4 class="anchored" data-anchor-id="create-a-project-folder"><strong>1. Create a project folder:</strong></h4>
<p>Begin by creating a new folder on your computer to house the task files. Choose a descriptive name for this folder (e.g., <code>Brief_RC_Task</code>, <code>BRC_Experiment</code>, or similar). This will help keep your files organized.</p>
</section>
<section id="download-files-from-github" class="level4">
<h4 class="anchored" data-anchor-id="download-files-from-github"><strong>2. Download files from GitHub:</strong></h4>
<p>Navigate to the GitHub repository: <a href="https://github.com/olivethree/briefRC" class="uri">https://github.com/olivethree/briefRC</a>. You will need to download the following:</p>
<ul>
<li><p><strong>HTML File:</strong> Download the HTML file that contains the application code.</p></li>
<li><p><strong><code>images</code> folder:</strong> Download the entire <code>images</code> folder, including all its contents (the image files used in the task). <em>It is crucial to maintain the folder structure; do not just download the images individually.</em></p></li>
</ul>
</section>
<section id="project-structure" class="level4">
<h4 class="anchored" data-anchor-id="project-structure"><strong>3. Project structure:</strong></h4>
<p>Place the downloaded HTML file and the <code>images</code> folder (with its contents) directly into the project folder you created in Step 1. The structure should look like this:</p>
<pre><code>Brief_RC_Task/       (Your project folder)
├── index.html      (Example HTML filename, but can be for example demo_briefrc_12.ENG.html)
└── images/         (The images folder, do not change the name of this folder)
    ├── *.png       (filenames follow a strict format like for example faceOri&lt;number&gt;.png)
    ├── *.png
    └── ...          (Other image files)</code></pre>
</section>
<section id="adjust-experiment-content-to-your-needs" class="level4">
<h4 class="anchored" data-anchor-id="adjust-experiment-content-to-your-needs"><strong>4. Adjust experiment content to your needs:</strong></h4>
<p>You can adjust the informed consent, task instructions, and trial instruction (very important as this is the target category you are interested in, e.g.&nbsp;Select the face that looks like &lt;YOUR_CATEGORY_OF_INTEREST&gt;).</p>
<p>To adjust these instructions, you can simply edit the content of the HTML file by opening it in your favorite IDE (e.g.&nbsp;<a href="https://code.visualstudio.com/">Visual Code</a>, <a href="https://notepad-plus-plus.org/">Notepad++,</a> Xcode, etc.) or text editor, and look for the text. In case you get lost, you can ask ChatGPT or similar chatbots for guidance on where to find this content (or even change it in a more efficient way through prompt engineering if you know what you’re doing…just remember to be critical of the output of generative AI, always verify!).</p>
</section>
<section id="run-the-experiment" class="level4">
<h4 class="anchored" data-anchor-id="run-the-experiment"><strong>5. Run the experiment</strong></h4>
<p>Open the HTML file (e.g., <code>index.html</code>) in your preferred web browser (e.g., Chrome, Firefox, Safari, Edge). The experiment should now load and be ready to use.</p>
</section>
<section id="results" class="level4">
<h4 class="anchored" data-anchor-id="results"><strong>6. Results:</strong></h4>
<p>Upon completion of a session, the results will be automatically saved to your browser’s default downloads folder (typically named “Downloads”).</p>
</section>
</section>
<section id="generating-individual-classification-images-from-brief-rc-task-data" class="level2">
<h2 class="anchored" data-anchor-id="generating-individual-classification-images-from-brief-rc-task-data">Generating Individual Classification Images from Brief RC task data</h2>
<p>In this section I provide an example of how to generate an individual classification image based on the data output of the Brief RC task. I will use the output format of the web version of the task I describe above (<a href="https://olivethree.github.io/briefrc12online/" class="uri">https://olivethree.github.io/briefrc12online/</a>).</p>
<p><strong>Note:</strong> <em>The code below only covers the generation of individual classification images. You can also generate Group CIs using the data from multiple participants, and loading it into R by combining into a single dataset. The data required for Group CI generation includes an additional column (string/factor) specifying target judgment condition, such as Star Wars Fan or Trustworthy. This additional column can then be used to compute the CI with the aggregated condition level data.</em></p>
<p>The output from the web version of the task I indicate above includes the following data:</p>
<table class="table">
<colgroup>
<col style="width: 8%">
<col style="width: 91%">
</colgroup>
<thead>
<tr class="header">
<th>Column</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>participant_number</td>
<td>[Essential] Identifier for each participant, provided by the user/experimenter in the first screen.</td>
</tr>
<tr class="even">
<td>response_id</td>
<td>[Essential] Unique identifier for each response. Can be used together with (or instead of) participant_number, point being you need a unique identifier for each participant.</td>
</tr>
<tr class="odd">
<td>ic_agree</td>
<td>Whether the participant agreed to informed consent (True/False)</td>
</tr>
<tr class="even">
<td>trial</td>
<td>[Essential] The trial number in the experiment. In this case, a total of 60 trials (per participant).</td>
</tr>
<tr class="odd">
<td>selected_image</td>
<td>File name of the specific image chosen by the participant during the trial</td>
</tr>
<tr class="even">
<td>image_number</td>
<td>[Essential] A numeric identifier for the selected image. This is crucial information, connected to the noise matrix text file created during the generation of the CIs for the task (see Script 1)</td>
</tr>
<tr class="odd">
<td>image_type</td>
<td><p>Indicates the type of image selected. Therefore, this is also the RESPONSE, reflecting the participant’s decision.</p>
<p>In a trial there are several pairs of images. Each pair is associated with a specific number (i.e., image_number). One of the images in the pair is original noise (coded as +1), the other is the inverted noise (coded as -1).</p></td>
</tr>
<tr class="even">
<td>timestamp</td>
<td>Timestamp of trial start.</td>
</tr>
<tr class="odd">
<td>image_1 to image_12</td>
<td>The 12 file names of the images displayed during the trial. Useful to verify if the 12 images correspond to six pairs of ori-inv images.</td>
</tr>
<tr class="even">
<td>age</td>
<td>Participant’s age.</td>
</tr>
<tr class="odd">
<td>gender</td>
<td>Participant’s gender.</td>
</tr>
</tbody>
</table>
<p>Not that if your data looks different, you need to tweak the code to adapt it to your case (the moidified function should always stay the same though).</p>
</section>
<section id="modified-function-to-generate-briefrc-cis" class="level2">
<h2 class="anchored" data-anchor-id="modified-function-to-generate-briefrc-cis">Modified function to generate BriefRC CIs</h2>
<p>Create a .R file with this content, and save it in your R projects’ root directory (where .Rproj file is located).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># BriefRC Task - Modified functions</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># How to use this file:</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Call this file from your CI generation script (use: source("rcicr_briefrc_mod.r"))</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Conditional installing of required packages</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(devtools)) <span class="fu">install.packages</span>(<span class="st">"devtools"</span>); <span class="fu">library</span>(devtools)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(rcicr)) devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">'rdotsch/rcicr'</span>); <span class="fu">library</span>(rcicr)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Modified functions below</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Matrix to image</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Generalized version of \code{magick::image_read()} which also</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co">#'  allows to read numerical objects.</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param img Image (e.g., image path) to be read, or numerical object (e.g., matrix, array)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' see \code{magick::image_read()} for more information (equivalent to `path` argument).</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param alpha (optional) Scalar indicating the trasnparency of the (alpha). If the object already</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' contains an alpha, than it will not be overwritten. Default is `1`.</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param density see \code{magick::image_read()}</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param depth see \code{magick::image_read()}</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param strip see \code{magick::image_read()}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples NULL</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export mat2img</span></span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>mat2img <span class="ot">&lt;-</span> <span class="cf">function</span>(img, <span class="at">density =</span> <span class="cn">NULL</span>, <span class="at">depth =</span> <span class="cn">NULL</span>, <span class="at">strip =</span> <span class="cn">FALSE</span>, <span class="at">alpha =</span> <span class="dv">1</span>) {</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If img is a path, try to read the image</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(img)) {</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">'png|PNG'</span>, img)) {</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>      img <span class="ot">&lt;-</span> png<span class="sc">::</span><span class="fu">readPNG</span>(img)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">'jpeg|JPEG|jpg|JPG'</span>, img)) {</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>      img <span class="ot">&lt;-</span> jpeg<span class="sc">::</span><span class="fu">readJPEG</span>(img)</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"Image format not supported"</span>)</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>  imgDim <span class="ot">&lt;-</span> <span class="fu">dim</span>(img)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>  alphaMatrix <span class="ot">&lt;-</span> <span class="fu">matrix</span>(alpha, imgDim[<span class="dv">1</span>], imgDim[<span class="dv">2</span>])</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># If img is a numerical object, transform it into an array which can be read by image_read()</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(imgDim) <span class="sc">&lt;</span> <span class="dv">3</span>) {</span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> <span class="fu">simplify2array</span>(<span class="fu">list</span>(img, img, img, alphaMatrix))</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (imgDim[<span class="dv">3</span>] <span class="sc">==</span> <span class="dv">3</span>) {</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>    img <span class="ot">&lt;-</span> <span class="fu">simplify2array</span>(<span class="fu">list</span>(img, alphaMatrix))</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>  magick<span class="sc">::</span><span class="fu">image_read</span>(img, <span class="at">density =</span> density, <span class="at">depth =</span> depth, <span class="at">strip =</span> strip)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Read and scale base image</span></span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Read and scale the base image</span></span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param baseImgPath String specifying path to the base image.</span></span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Vector of pixels from the base image.</span></span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples NULL</span></span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export readBaseImg</span></span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a>readBaseImg <span class="ot">&lt;-</span> <span class="cf">function</span>(baseImgPath, <span class="at">maxContrast =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read image</span></span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">'png|PNG'</span>, baseImgPath)) {</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>    baseImg <span class="ot">&lt;-</span> png<span class="sc">::</span><span class="fu">readPNG</span>(baseImgPath)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">grepl</span>(<span class="st">'jpeg|JPEG|jpg|JPG'</span>, baseImgPath)) {</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>    baseImg <span class="ot">&lt;-</span> jpeg<span class="sc">::</span><span class="fu">readJPEG</span>(baseImgPath)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Base image format not supported"</span>)</span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure there is only 2 dimensions</span></span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(<span class="fu">dim</span>(baseImg)) <span class="sc">==</span> <span class="dv">3</span>) baseImg <span class="ot">&lt;-</span> baseImg[, , <span class="dv">1</span>]</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Maximize base image contrast</span></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (maxContrast) baseImg <span class="ot">&lt;-</span> (baseImg <span class="sc">-</span> <span class="fu">min</span>(baseImg))<span class="sc">/</span>(<span class="fu">max</span>(baseImg) <span class="sc">-</span> <span class="fu">min</span>(baseImg))</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">as.vector</span>(baseImg) )</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Generate (and scale) mask from responses</span></span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Generate (and scale) mask from responses.</span></span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param response Numerical vector specifying the reponses.</span></span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param stim Numerical vector specifying the stimuli number.</span></span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param noiseMatrix Matrix of noise pattern as generated with</span></span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a><span class="co">#'   \code{noiseMatrix &lt;- rcirc::generateStimuli2IFC(..., return_as_dataframe = TRUE)}.</span></span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param baseImg Numerical vector containing the baseImg image or string pointing to the baseImg</span></span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a><span class="co">#'   image file. If baseImg is a string, then the baseImg image must in .png or .jpeg.</span></span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param scaling String|Scalar|NULL specifying the scaling method. `"matched"` is the default method.</span></span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a><span class="co">#'   If a scalar is provided (e.g. 5) than the `"constant"` method will be applied.</span></span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a><span class="co">#'   If `NULL` no scaling is applied.</span></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return List with the (un)scaled Noise mask (\code{$mask}) and the base image as a vector</span></span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a><span class="co">#'   (\code{$baseImgVect}).</span></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples NULL</span></span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export genMask</span></span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>genMask <span class="ot">&lt;-</span> <span class="cf">function</span>(response, stim, noiseMatrix, baseImg, <span class="at">scaling =</span> <span class="st">"matched"</span>) {</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate mask</span></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>  X  <span class="ot">&lt;-</span> data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">response =</span> response, <span class="at">stim =</span> stim)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>  X  <span class="ot">&lt;-</span> X[, .(<span class="at">response =</span> <span class="fu">mean</span>(response)), stim]</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>  mask <span class="ot">&lt;-</span> (noiseMatrix[, X<span class="sc">$</span>stim] <span class="sc">%*%</span> X<span class="sc">$</span>response) <span class="sc">/</span> <span class="fu">length</span>(X<span class="sc">$</span>response)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read base image</span></span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.character</span>(baseImg)) baseImg <span class="ot">&lt;-</span> <span class="fu">readBaseImg</span>(baseImg)</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Scale mask</span></span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (scaling <span class="sc">==</span> <span class="st">"matched"</span>) {</span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a>    scaledMask <span class="ot">&lt;-</span> <span class="fu">min</span>(baseImg)<span class="sc">+</span>((<span class="fu">max</span>(baseImg)<span class="sc">-</span><span class="fu">min</span>(baseImg))<span class="sc">*</span>(mask<span class="sc">-</span><span class="fu">min</span>(mask))<span class="sc">/</span>(<span class="fu">max</span>(mask)<span class="sc">-</span><span class="fu">min</span>(mask)))</span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.numeric</span>(scaling)) { <span class="co"># constant scaling</span></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>    scaledMask <span class="ot">&lt;-</span> (mask <span class="sc">+</span> scaling)<span class="sc">/</span>(<span class="dv">2</span> <span class="sc">*</span> scaling)</span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">max</span>(scaledMask) <span class="sc">&gt;</span> <span class="dv">1</span> <span class="sc">|</span> <span class="fu">min</span>(scaledMask) <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">1</span>) <span class="fu">warning</span>(<span class="st">"Constant is too low! Adjust."</span>)</span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.null</span>(scaling)) { <span class="co"># No scaling</span></span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a>    scaledMask <span class="ot">&lt;-</span> mask</span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">mask =</span> scaledMask, <span class="at">baseImgVect =</span> baseImg))</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Generate Classification Image (CI)</span></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Generate the combinaed of the noise mask (mask) and the base image.</span></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a><span class="co">#' @inheritParams genMask</span></span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param outputPath String specifying the file path of the ouput CI. Default is `"combined.png"`.</span></span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return NULL</span></span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples NULL</span></span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export genCI</span></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>genCI <span class="ot">&lt;-</span> <span class="cf">function</span>(response, stim, noiseMatrix, baseImg, <span class="at">scaling =</span> <span class="st">"matched"</span>,</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a>                  <span class="at">outputPath =</span> <span class="st">"combined.png"</span>) {</span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate mask</span></span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>  M <span class="ot">&lt;-</span> <span class="fu">genMask</span>(response, stim, noiseMatrix, baseImg, scaling)</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>  mask <span class="ot">&lt;-</span> M<span class="sc">$</span>mask</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>  baseImgVect <span class="ot">&lt;-</span> M<span class="sc">$</span>baseImgVect</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write and save combined image</span></span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> (baseImgVect <span class="sc">+</span> mask) <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>  combined <span class="ot">&lt;-</span> <span class="fu">matrix</span>(combined, <span class="at">nrow =</span> <span class="dv">512</span>)</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>  png<span class="sc">::</span><span class="fu">writePNG</span>(combined, outputPath)</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Return file path</span></span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(outputPath)</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a><span class="co">#' @title Get face region</span></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description Returns a logical vector with the face region</span></span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param imgPath String specifying path to the base image.</span></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param xpos Numeric specifiying the X position (relative to the center).</span></span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param ypos Numeric specifiying the Y position (relative to the center).</span></span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param faceWidth Numeric specifiying the width of the face region.</span></span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param faceHeight Numeric specifiying the height of the face region.</span></span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param preview Numeric specifiying the height of the face region.</span></span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param writeImgTo String specifying where and if the output image should be saved. Default is</span></span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a><span class="co">#'   NULL, meaning that the image will not be saved.</span></span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a><span class="co">#' @return Logical vector specifying the location of the face region</span></span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples NULL</span></span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a><span class="co">#' @export getFaceRegion</span></span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>getFaceRegion <span class="ot">&lt;-</span> <span class="cf">function</span>(imgPath,</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>                          <span class="at">xpos =</span> <span class="dv">0</span>, <span class="at">ypos =</span> <span class="dv">0</span>, <span class="at">faceWidth =</span> <span class="fl">1.4</span>, <span class="at">faceHeight =</span> <span class="fl">1.8</span>,</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>                          <span class="at">preview =</span> <span class="cn">TRUE</span>, <span class="at">writeImgTo =</span> <span class="cn">NULL</span>) {</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Read image and convert to matrix</span></span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a>  face <span class="ot">&lt;-</span> <span class="fu">readBaseImg</span>(imgPath)</span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>  faceLength <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">length</span>(face)) <span class="co"># must be squared</span></span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>  face <span class="ot">&lt;-</span> <span class="fu">matrix</span>(face, <span class="at">ncol =</span> faceLength)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Define face region: https://dahtah.github.io/imager/gimptools.html</span></span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>  Xcc <span class="ot">&lt;-</span> <span class="cf">function</span>(im) imager<span class="sc">::</span><span class="fu">Xc</span>(im) <span class="sc">-</span> imager<span class="sc">::</span><span class="fu">width</span>(im)<span class="sc">/</span><span class="dv">2</span>  <span class="sc">+</span> ypos</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>  Ycc <span class="ot">&lt;-</span> <span class="cf">function</span>(im) imager<span class="sc">::</span><span class="fu">Yc</span>(im) <span class="sc">-</span> imager<span class="sc">::</span><span class="fu">height</span>(im)<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> xpos</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a>  NN <span class="ot">&lt;-</span> imager<span class="sc">::</span><span class="fu">as.cimg</span>( <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span>faceLength<span class="sc">^</span><span class="dv">2</span>, <span class="at">nrow =</span> faceLength) )</span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a>  faceRegion <span class="ot">&lt;-</span> (<span class="fu">Xcc</span>(NN)<span class="sc">/</span>faceHeight)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> (<span class="fu">Ycc</span>(NN)<span class="sc">/</span>faceWidth)<span class="sc">^</span><span class="dv">2</span> <span class="sc">&lt;</span> <span class="dv">100</span><span class="sc">^</span><span class="dv">2</span></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>  faceRegion <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(faceRegion)</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Preview in Viewer</span></span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (preview) {</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a>    alphaMask <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, faceLength, faceLength)</span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>    alphaMask[<span class="sc">!</span>faceRegion] <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a>    previewFace <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(face, alphaMask, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>    previewFacePath <span class="ot">&lt;-</span> <span class="fu">tempfile</span>(<span class="at">fileext =</span> <span class="st">".png"</span>)</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>    png<span class="sc">::</span><span class="fu">writePNG</span>(previewFace, previewFacePath)</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>    <span class="fu">invisible</span>(<span class="fu">capture.output</span>(<span class="fu">print</span>(magick<span class="sc">::</span><span class="fu">image_read</span>(previewFacePath))))</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Write face</span></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(writeImgTo)) {</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>    alphaMask <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, faceLength, faceLength)</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>    alphaMask[<span class="sc">!</span>faceRegion] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>    printedFace <span class="ot">&lt;-</span> abind<span class="sc">::</span><span class="fu">abind</span>(face, alphaMask, <span class="at">along =</span> <span class="dv">3</span>)</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>    png<span class="sc">::</span><span class="fu">writePNG</span>(printedFace, writeImgTo)</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(faceRegion)</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="script-to-generate-individual-ci" class="level2">
<h2 class="anchored" data-anchor-id="script-to-generate-individual-ci">Script to generate Individual CI</h2>
<p>Here is how you can generate the individual CI from the Brief RC task data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Clear environment</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Libraries</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(purrr)</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vroom)</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(png)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Modified rcicr function</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Make sure this file is in the same directory as the current file (both should be by default at the RProj root dir)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"rcicr_briefrc_mod.r"</span>)</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Load data</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># LOAD A SINGLE PARTICIPANT'S DATA FILE</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>rawdata <span class="ot">&lt;-</span> vroom<span class="sc">::</span><span class="fu">vroom</span>(here<span class="sc">::</span><span class="fu">here</span>(<span class="st">"data"</span>, <span class="st">"brief_rc_data_Rz2aqjzk31.csv"</span>)) <span class="co"># Replace CSV file with your own file</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Data Processing</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Keep only relevant variables for CI generation</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>input_df <span class="ot">&lt;-</span> rawdata <span class="sc">%&gt;%</span> </span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(participant_number, trial, image_number, image_type, selected_image) <span class="sc">%&gt;%</span> </span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">response =</span> image_type) <span class="co"># clarifies that the participant response is the same as teh selected image_type</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect data set</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>input_df <span class="sc">%&gt;%</span> names</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename participant_number as id and change its type to factor</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>rc_brief_df <span class="ot">&lt;-</span> input_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">id =</span> participant_number <span class="sc">%&gt;%</span> as.factor)</span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate CIs</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters</span></span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>basePath <span class="ot">&lt;-</span> <span class="st">"FMNES.jpg"</span> <span class="co"># Base face image, loacted in root directory</span></span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a>noisemat <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>( <span class="fu">fread</span>(<span class="st">"noise_matrix.txt"</span>) ) <span class="co"># Load the noise matrix created at the time of stimuli generation</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Individual CIs</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating sub directory to store individual CIs</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a>indcis_dir <span class="ot">&lt;-</span> <span class="st">"ind_cis"</span></span>
<span id="cb4-46"><a href="#cb4-46" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(indcis_dir)) {</span>
<span id="cb4-47"><a href="#cb4-47" aria-hidden="true" tabindex="-1"></a> <span class="fu">dir.create</span>(indcis_dir)</span>
<span id="cb4-48"><a href="#cb4-48" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Directory '%s' created."</span>, indcis_dir))</span>
<span id="cb4-49"><a href="#cb4-49" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb4-50"><a href="#cb4-50" aria-hidden="true" tabindex="-1"></a> <span class="fu">message</span>(<span class="fu">sprintf</span>(<span class="st">"Directory '%s' already exists."</span>, indcis_dir))</span>
<span id="cb4-51"><a href="#cb4-51" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-52"><a href="#cb4-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-53"><a href="#cb4-53" aria-hidden="true" tabindex="-1"></a><span class="co"># convert data frame to data.table object (data.table handles larger data better and more efficiently)</span></span>
<span id="cb4-54"><a href="#cb4-54" aria-hidden="true" tabindex="-1"></a>rc_brief_dt <span class="ot">&lt;-</span> rc_brief_df <span class="sc">%&gt;%</span> <span class="fu">as.data.table</span>()</span>
<span id="cb4-55"><a href="#cb4-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-56"><a href="#cb4-56" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate individual CI(s)</span></span>
<span id="cb4-57"><a href="#cb4-57" aria-hidden="true" tabindex="-1"></a>rc_brief_dt[, <span class="fu">genCI</span>(</span>
<span id="cb4-58"><a href="#cb4-58" aria-hidden="true" tabindex="-1"></a>  <span class="at">outputPath  =</span> <span class="fu">paste0</span>(<span class="st">"ind_cis/ind_"</span>, id, <span class="st">".png"</span>)[<span class="dv">1</span>],</span>
<span id="cb4-59"><a href="#cb4-59" aria-hidden="true" tabindex="-1"></a>  <span class="at">stim        =</span> image_number,</span>
<span id="cb4-60"><a href="#cb4-60" aria-hidden="true" tabindex="-1"></a>  <span class="at">response    =</span> response,</span>
<span id="cb4-61"><a href="#cb4-61" aria-hidden="true" tabindex="-1"></a>  <span class="at">baseImg     =</span> basePath,</span>
<span id="cb4-62"><a href="#cb4-62" aria-hidden="true" tabindex="-1"></a>  <span class="at">scaling     =</span> <span class="st">"matched"</span>, <span class="co"># this parameter might have to be tweaked by trial and error if you use different base images</span></span>
<span id="cb4-63"><a href="#cb4-63" aria-hidden="true" tabindex="-1"></a>  <span class="at">noiseMatrix =</span> noisemat</span>
<span id="cb4-64"><a href="#cb4-64" aria-hidden="true" tabindex="-1"></a>), id]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can find your individual CI result in the ” ind_cis” folder. It’s file name includes the participant number associated with it.</p>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ul>
<li>Lundqvist, D., Flykt, A., &amp; Öhman, A. (1998). <em>Karolinska Directed Emotional Faces (KDEF)</em> [Database record]. APA PsycTests. <a href="https://psycnet.apa.org/doi/10.1037/t27732-000" title="DOI link">https://doi.org/10.1037/t27732-000</a></li>
<li>Schmitz, M., Rougier, M., &amp; Yzerbyt, V. (2024). Introducing the brief reverse correlation: An improved tool to assess visual representations. <em>European Journal of Social Psychology</em>. Advance Online Publication. <a href="https://doi.org/10.1002/ejsp.3100"><strong>https://doi.org/10.1002/ejsp.3100</strong></a></li>
</ul>
<hr>
</section>
</section>
<section id="reverse-correlation-sampling-subgroup-cis" class="level1">
<h1><a href="https://olivethree.shinyapps.io/shinyRC_subgroup_cis/">Reverse Correlation: Sampling Subgroup CIs</a></h1>
<p>This shiny app facilitates the generation of the so-called ‘subgroup’ classification images (CIs) for a two-phase reverse correlation methodology.</p>
<p>Read the post at <a href="https://manueloliveira.nl/posts/p_2/">Blog</a> or <a href="https://medium.com/@manueljbo/improved-two-phase-reverse-correlation-method-in-psychological-research-overview-and-r-tutorial-dfb66f95553c">Medium</a></p>
<p>The use of subgroup CIs is a currently one of the recommended practices for the phase of classification image validation in psychological research involving a two-phase variant of the psychophysical reverse correlation method (e.g.&nbsp;<a href="https://journals.sagepub.com/doi/abs/10.1177/1948550611430272">Dotsch &amp; Todorov, 2012</a>). In practice, this implies using the data collected during the first phase (reverse correlation task) to generate multiple group-level CIs associated with the same target construct condition (i.e.&nbsp;several ‘Trustworthy’ subgroup CIs vs.&nbsp;single ‘Trustworthy’ group CI ). These are then validated through simple ratings on a target category of interest (e.g.&nbsp;how trustworthy? how Portuguese? how attractive? etc.) in the second phase by a entirely new group of raters.</p>
<p>Using subgroup CIs helps decrease the number of images to rate in the second phase, compared to the alternative (but more time consuming) option of rating all the individual CIs generated by each participant in the first phase. This approach circumvents the issues (e.g.&nbsp;type I error inflation) associated with using a single group CI in the second phase (see <a href="https://journals.sagepub.com/doi/10.1177/1948550620938616">Cone et al., 2021</a>).</p>
<p>For more details see: <a href="https://github.com/olivethree/shinyrc_subgroupcis" class="uri">https://github.com/olivethree/shinyrc_subgroupcis</a></p>
<hr>
</section>
<section id="face-masker" class="level1">
<h1><a href="https://github.com/olivethree/webcam_face_masker" id="face-masker">Face Masker</a></h1>
<p><strong>Real-time webcam face masking</strong></p>
<p>This application applies a facial mask to any faces captured by the webcam. You can also take snapshots and store them in jpeg format. It was developed during my free time as a hobby project, years before AI chatbots could do this for me in 5 seconds. I leave it up to you to decide how useful this app/code may be to you. The app is quite limited and I stopped working on it a long time ago, but maybe it can inspire you to start something better :)</p>
<p><strong>Running the app</strong>: For now, the only way to run the Face Masker app is from source code “~/src/<strong>facemasker_main.py</strong>” script.</p>
<p><a href="https://github.com/olivethree/webcam_face_masker/archive/refs/heads/master.zip">Download Face Masker source code</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } 
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2024, Manuel Oliveira</div>   
  </div>
</footer>



</body></html>